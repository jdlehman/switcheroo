!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define("switcheroo",["react"],t):e.switcheroo=t(e.React)}(this,function(e){"use strict";function t(e){var t=decodeURI(window.location[e].slice(1).split("?")[0]);return"/"!==t.charAt(0)?"/"+t:t}function n(e){return"/"===e?e:"/"!==e.slice(-1)?e:e.slice(0,-1)}function o(e){return e.replace(/\/:[^\/]+/g,"/([^/]+)")}function r(e){var t=e.match(/:[^\/]+/g)||[];return t.map(function(e){return e.substr(1)})}function a(e,t){return o(n(e+t)+"/?")}function i(e){return new RegExp("^("+e.join("|")+")$")}function s(t,o){var r=o.children,s=o.basePath,p=n(t),c=e.Children.toArray(r);return c.filter(function(e){var t=[].concat(e.props.path).map(function(e){return a(s,e)}),n=i(t);return n.test(p)})[0]||null}function p(e,t,o){if(!o)return null;var r=n(e),i=[].concat(o.props.path);return i.filter(function(e){var n=a(t,e),o=new RegExp("^"+n+"$");return o.test(r)})[0]||null}function c(e,t,o){var i={},s=n(e);return o&&[].concat(o.props.path).forEach(function(e){var n=r(t+e),o=a(t,e),p=s.match(new RegExp("^"+o+"$"));p&&(p.shift(),n.forEach(function(e,t){i[e]=p[t]}))}),i}var u="default"in e?e.default:e,h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},b=function(e){function n(e){l(this,n);var o=v(this,Object.getPrototypeOf(n).call(this,e));w.call(o);var r=t(e.location),a=s(r,e),i=p(r,e.basePath,a),u=c(r,e.basePath,a);return o.state={visibleSwitch:a,dynamicValues:u,activePath:i},o}return y(n,e),f(n,[{key:"componentDidMount",value:function(){this.props.load&&window.addEventListener("load",this.handleRouteChange),this.props.pushState&&window.addEventListener("popstate",this.handleRouteChange),this.props.hashChange&&window.addEventListener("hashchange",this.handleRouteChange)}},{key:"componentWillReceiveProps",value:function(e){this.handleSwitchChange(e)}},{key:"shouldComponentUpdate",value:function(e){return!e.preventUpdate()}},{key:"componentWillUnmount",value:function(){this.props.load&&window.removeEventListener("load",this.handleRouteChange),this.props.pushState&&window.removeEventListener("popstate",this.handleRouteChange),this.props.hashChange&&window.removeEventListener("hashchange",this.handleRouteChange)}},{key:"render",value:function(){var e=this,t=this.state.visibleSwitch||{},o=t.props,r=this.state.visibleSwitch&&u.cloneElement(this.state.visibleSwitch,d({},o,this.props.mapDynamicSegments(this.state.dynamicValues),{activePath:this.state.activePath}));if(this.props.renderSwitch)return this.props.renderSwitch(r,this.state.dynamicValues,this.state.activePath);if(!this.props.wrapper)return r;var a=function(){var t=d({},e.props);return Object.keys(n.propTypes).forEach(function(e){return delete t[e]}),{v:u.createElement(e.props.wrapper,t,r)}}();return"object"===("undefined"==typeof a?"undefined":h(a))?a.v:void 0}}]),n}(e.Component);b.displayName="Switcher",b.propTypes={children:e.PropTypes.oneOfType([e.PropTypes.arrayOf(e.PropTypes.node),e.PropTypes.node]),pushState:e.PropTypes.bool,hashChange:e.PropTypes.bool,load:e.PropTypes.bool,onChange:e.PropTypes.func,wrapper:e.PropTypes.any,location:e.PropTypes.string,basePath:e.PropTypes.string,preventUpdate:e.PropTypes.func,mapDynamicSegments:e.PropTypes.func,renderSwitch:e.PropTypes.func},b.defaultProps={pushState:!1,hashChange:!0,load:!0,location:"hash",basePath:"",preventUpdate:function(){return!1},mapDynamicSegments:function(e){return e}};var w=function(){var e=this;this.handleSwitchChange=function(n){var o=t(n.location),r=s(o,n),a=p(o,n.basePath,r),i=c(o,n.basePath,r);"function"==typeof n.onChange&&n.onChange(!!r,o,i,a),e.setState({visibleSwitch:r,dynamicValues:i,activePath:a})},this.handleRouteChange=function(t){e.handleSwitchChange(e.props)}};return b});
