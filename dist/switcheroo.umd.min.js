!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define("switcheroo",["exports","react","prop-types"],t):t(e.switcheroo=e.switcheroo||{},e.React,e.PropTypes)}(this,function(e,t,n){"use strict";function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function i(e){var t=decodeURI(window.location[e].slice(1).split("?")[0]);return"/"!==t.charAt(0)?"/"+t:t}function o(e){return"/"===e?e:"/"!==e.slice(-1)?e:e.slice(0,-1)}function a(e){return e.replace(/\/:[^\/]+/g,"/([^/]+)")}function s(e){return(e.match(/:[^\/]+/g)||[]).map(function(e){return e.substr(1)})}function h(e,t){return a(o(e+t)+"/?")}function c(e){return new RegExp("^("+e.join("|")+")$")}function p(e,n){var r=n.children,i=n.basePath,a=o(e);return t.Children.toArray(r).filter(function(e){return c([].concat(e.props.path).map(function(e){return h(i,e)})).test(a)})[0]||null}function u(e,t,n){if(!n)return null;var r=o(e);return[].concat(n.props.path).filter(function(e){var n=h(t,e);return new RegExp("^"+n+"$").test(r)})[0]||null}function d(e,t,n){var r={},i=o(e);return n&&[].concat(n.props.path).forEach(function(e){var n=s(t+e),o=h(t,e),a=i.match(new RegExp("^"+o+"$"));a&&(a.shift(),n.forEach(function(e,t){r[e]=a[t]}))}),r}var l="default"in t?t.default:t;n="default"in n?n.default:n;var f=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},g=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},x=function(e){function t(e){f(this,t);var n=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));m.call(n);var r=i(e.location),o=p(r,e),a=u(r,e.basePath,o),s=d(r,e.basePath,o);return n.state={visibleSwitch:o,dynamicValues:s,activePath:a},n}return y(t,e),v(t,[{key:"componentDidMount",value:function(){var e=this.context.switcherProvider;e&&(this._id=r()),this.props.load&&(e?this.context.switcherProvider.loadListeners.push({id:this._id,fn:this.handleRouteChange}):window.addEventListener("load",this.handleRouteChange)),this.props.pushState&&(e?this.context.switcherProvider.popStateListeners.push({id:this._id,fn:this.handleRouteChange}):window.addEventListener("popstate",this.handleRouteChange)),this.props.hashChange&&(e?this.context.switcherProvider.hashChangeListeners.push({id:this._id,fn:this.handleRouteChange}):window.addEventListener("hashchange",this.handleRouteChange))}},{key:"componentWillReceiveProps",value:function(e){this.handleSwitchChange(e)}},{key:"shouldComponentUpdate",value:function(e){return!e.preventUpdate()}},{key:"componentWillUnmount",value:function(){this.props.load&&window.removeEventListener("load",this.handleRouteChange),this.props.pushState&&window.removeEventListener("popstate",this.handleRouteChange),this.props.hashChange&&window.removeEventListener("hashchange",this.handleRouteChange)}},{key:"render",value:function(){var e=(this.state.visibleSwitch||{}).props,n=this.state.visibleSwitch&&l.cloneElement(this.state.visibleSwitch,w({},e,this.props.mapDynamicSegments(this.state.dynamicValues),{activePath:this.state.activePath}));if(this.props.renderSwitch)return this.props.renderSwitch(n,this.state.dynamicValues,this.state.activePath);if(this.props.wrapper){var r=w({},this.props);return Object.keys(t.propTypes).forEach(function(e){return delete r[e]}),l.createElement(this.props.wrapper,r,n)}return n}}]),t}(t.Component);x.displayName="Switcher",x.propTypes={children:n.oneOfType([n.arrayOf(n.node),n.node]),pushState:n.bool,hashChange:n.bool,load:n.bool,onChange:n.func,wrapper:n.any,location:n.string,basePath:n.string,preventUpdate:n.func,mapDynamicSegments:n.func,renderSwitch:n.func},x.contextTypes={switcherProvider:n.shape({loadListeners:n.array.isRequired,popStateListeners:n.array.isRequired,hashChangeListeners:n.array.isRequired})},x.defaultProps={pushState:!1,hashChange:!0,load:!0,location:"hash",basePath:"",preventUpdate:function(){return!1},mapDynamicSegments:function(e){return e}};var m=function(){var e=this;this.handleSwitchChange=function(t){var n=i(t.location),r=p(n,t),o=u(n,t.basePath,r),a=d(n,t.basePath,r);"function"==typeof t.onChange&&t.onChange(!!r,n,a,o),e.setState({visibleSwitch:r,dynamicValues:a,activePath:o})},this.handleRouteChange=function(t){e.handleSwitchChange(e.props)}},P=function(e){function t(){var e,n,r,i;f(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=r=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.switcherProvider={loadListeners:[],popStateListeners:[],hashChangeListeners:[]},r.handleLoadListeners=function(e){r.switcherProvider.loadListeners.forEach(function(t){return(0,t.fn)(e)})},r.handlePopStateListeners=function(e){r.switcherProvider.popStateListeners.forEach(function(t){return(0,t.fn)(e)})},r.handleHashChangeListeners=function(e){r.switcherProvider.hashChangeListeners.forEach(function(t){return(0,t.fn)(e)})},i=n,g(r,i)}return y(t,e),v(t,[{key:"getChildContext",value:function(){return{switcherProvider:this.switcherProvider}}},{key:"componentDidMount",value:function(){window.addEventListener("load",this.handleLoadListeners),window.addEventListener("popstate",this.handlePopStateListeners),window.addEventListener("hashchange",this.handleHashChangeListeners)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("load",this.handleLoadListeners),window.removeEventListener("popstate",this.handlePopStateListeners),window.removeEventListener("hashchange",this.handleHashChangeListeners)}},{key:"render",value:function(){return this.props.children}}]),t}(t.Component);P.displayName="SwitcherProvider",P.propTypes={children:t.PropTypes.node},P.childContextTypes={switcherProvider:t.PropTypes.shape({loadListeners:t.PropTypes.array.isRequired,popStateListeners:t.PropTypes.array.isRequired,hashChangeListeners:t.PropTypes.array.isRequired})},e.default=x,e.SwitcherProvider=P,Object.defineProperty(e,"__esModule",{value:!0})});
