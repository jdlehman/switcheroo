!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define("switcheroo",["react"],t):e.switcheroo=t(e.React)}(this,function(e){"use strict";function t(e){var t=decodeURI(window.location[e].slice(1).split("?")[0]);return"/"!==t.charAt(0)?"/"+t:t}function n(e){return"/"===e?e:"/"!==e.slice(-1)?e:e.slice(0,-1)}function r(e){return e.replace(/\/:[^\/]+/g,"/([^/]+)")}function o(e){var t=e.match(/:[^\/]+/g)||[];return t.map(function(e){return e.substr(1)})}function a(e,t){return r(n(e+t)+"/?")}function i(e){return new RegExp("^("+e.join("|")+")$")}function s(t,r){var o=r.children,s=r.basePath,u=n(t),c=e.Children.toArray(o);return c.filter(function(e){var t=[].concat(e.props.path).map(function(e){return a(s,e)}),n=i(t);return n.test(u)})[0]||null}function u(e,t,r){if(!r)return null;var o=n(e),i=[].concat(r.props.path);return i.filter(function(e){var n=a(t,e),r=new RegExp("^"+n+"$");return r.test(o)})[0]||null}function c(e,t,r){var i={},s=n(e);return r&&[].concat(r.props.path).forEach(function(e){var n=o(t+e),r=a(t,e),u=s.match(new RegExp("^"+r+"$"));u&&(u.shift(),n.forEach(function(e,t){i[e]=u[t]}))}),i}var p="default"in e?e.default:e,h=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var s={key:e,arg:t,resolve:n,reject:o,next:null};i?i=i.next=s:(a=i=s,r(e,t))})}function r(n,a){try{var i=t[n](a),s=i.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(i.done?"return":"normal",i.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}a=a.next,a?r(a.key,a.arg):i=null}var a,i;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},y=function(e){function n(e){h(this,n);var r=v(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));w.call(r);var o=t(e.location),a=s(o,e),i=u(o,e.basePath,a),p=c(o,e.basePath,a);return r.state={visibleSwitch:a,dynamicValues:p,activePath:i},r}return d(n,e),l(n,[{key:"componentDidMount",value:function(){this.props.load&&window.addEventListener("load",this.handleRouteChange),this.props.pushState&&window.addEventListener("popstate",this.handleRouteChange),this.props.hashChange&&window.addEventListener("hashchange",this.handleRouteChange)}},{key:"componentWillReceiveProps",value:function(e){this.handleSwitchChange(e)}},{key:"shouldComponentUpdate",value:function(e){return!e.preventUpdate()}},{key:"componentWillUnmount",value:function(){this.props.load&&window.removeEventListener("load",this.handleRouteChange),this.props.pushState&&window.removeEventListener("popstate",this.handleRouteChange),this.props.hashChange&&window.removeEventListener("hashchange",this.handleRouteChange)}},{key:"render",value:function(){var e=this.state.visibleSwitch||{},t=e.props,r=this.state.visibleSwitch&&p.cloneElement(this.state.visibleSwitch,f({},t,this.props.mapDynamicSegments(this.state.dynamicValues),{activePath:this.state.activePath}));if(this.props.renderSwitch)return this.props.renderSwitch(r,this.state.dynamicValues,this.state.activePath);if(this.props.wrapper){var o=f({},this.props);return Object.keys(n.propTypes).forEach(function(e){return delete o[e]}),p.createElement(this.props.wrapper,o,r)}return r}}]),n}(e.Component);y.displayName="Switcher",y.propTypes={children:e.PropTypes.oneOfType([e.PropTypes.arrayOf(e.PropTypes.node),e.PropTypes.node]),pushState:e.PropTypes.bool,hashChange:e.PropTypes.bool,load:e.PropTypes.bool,onChange:e.PropTypes.func,wrapper:e.PropTypes.any,location:e.PropTypes.string,basePath:e.PropTypes.string,preventUpdate:e.PropTypes.func,mapDynamicSegments:e.PropTypes.func,renderSwitch:e.PropTypes.func},y.defaultProps={pushState:!1,hashChange:!0,load:!0,location:"hash",basePath:"",preventUpdate:function(){return!1},mapDynamicSegments:function(e){return e}};var w=function(){var e=this;this.handleSwitchChange=function(n){var r=t(n.location),o=s(r,n),a=u(r,n.basePath,o),i=c(r,n.basePath,o);"function"==typeof n.onChange&&n.onChange(!!o,r,i,a),e.setState({visibleSwitch:o,dynamicValues:i,activePath:a})},this.handleRouteChange=function(t){e.handleSwitchChange(e.props)}};return y});
